name: CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install

    # 新しいステップ: API Gatewayエンドポイントのテスト
    - name: Test API Gateway endpoint using curl
      run: |
        response=$(curl -X PUT ${{ secrets.API_GATEWAY_ENDPOINT }} -H "Content-Type: application/json; charset=UTF-8" -d "{\"userId\":\"example@email.com\",\"mDt\":\"2021-12-31T23:59:59.999Z\",\"lat\":\"35.6895\",\"lng\":\"139.6917\",\"speed\":10,\"driveMode\":1,\"charge\":80,\"driveUnitErr\":\"00000000\",\"lockState\":true,\"lockId\":\"XXX0000\",\"lockErr\":\"00000000\"}")
        
        # 応答に期待するキーが含まれているかをチェックする
        echo "$response" | grep '"userId"'
        echo "$response" | grep '"rDt"'